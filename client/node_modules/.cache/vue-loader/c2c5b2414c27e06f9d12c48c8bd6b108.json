{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\src\\views\\system\\perm.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\src\\views\\system\\perm.vue","mtime":1620834720964},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getPermAll, createPerm, deletePerm, updatePerm } from '@/api/perm'\nimport { genTree } from '@/utils'\nimport checkPermission from '@/utils/permission'\nimport Treeselect from '@riophae/vue-treeselect'\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\nconst defaultPerm = {\n        id: null,\n        name: '',\n        type: '目录',\n        method: '',\n        sort:1,\n        parent: null\n      }\nexport default {\n  components: { Treeselect },\n  data() {\n    return {\n      perm: defaultPerm,\n      search: '',\n      tableData: [],\n      permList: [],\n      listLoading: true,\n      dialogVisible: false,\n      dialogType: 'new',\n      rule1: {\n        name: [{ required: true, message: '请输入名称', trigger: 'blur' }],\n        method: [{ required: true, message: '请输入代号', trigger: 'blur' }]\n      }\n    }\n  },\n  computed: {},\n  created() {\n    this.getList()\n  },\n  methods: {\n    checkPermission,\n    getList() {\n      this.listLoading = true\n      getPermAll().then(response => {\n        this.permList = response.data\n        const data = genTree(response.data)\n        this.tableData = data\n        this.listLoading = false\n      })\n    },\n    resetFilter() {\n      this.getList()\n    },\n    handleFilter() {\n      const newData = this.permList.filter(\n        data =>\n          !this.search ||\n          data.name.toLowerCase().includes(this.search.toLowerCase())\n      )\n      this.tableData = genTree(newData)\n    },\n    handleAdd() {\n      this.perm = Object.assign({}, defaultPerm)\n      this.dialogType = 'new'\n      this.dialogVisible = true\n      this.$nextTick(() => {\n        this.$refs['Form'].clearValidate()\n      })\n    },\n    handleEdit(scope) {\n      this.perm = Object.assign({}, scope.row) // copy obj\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.$nextTick(() => {\n        this.$refs['Form'].clearValidate()\n      })\n    },\n    handleDelete(scope) {\n      this.$confirm('确认删除?', '警告', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'error'\n      })\n        .then(async() => {\n          await deletePerm(scope.row.id)\n          this.getList()\n          this.$message({\n            type: 'success',\n            message: '成功删除!'\n          })\n        })\n        .catch(err => {\n          console.error(err)\n        })\n    },\n    async confirmPerm(form) {\n      this.$refs[form].validate(valid => {\n        if (valid) {\n          const isEdit = this.dialogType === 'edit'\n          if (isEdit) {\n            updatePerm(this.perm.id, this.perm).then(() => {\n              this.getList()\n              this.dialogVisible = false\n              this.$message({\n                message: '编辑成功',\n                type: 'success',\n              })\n            })\n          } else {\n            createPerm(this.perm).then(res => {\n              // this.perm = res.data\n              // this.tableData.unshift(this.perm)\n              this.getList()\n              this.dialogVisible = false\n              this.$message({\n                message: '新增成功',\n                type: 'success',\n              })\n            })\n          }\n        } else {\n          return false\n        }\n      })\n    }\n  }\n}\n",null]}