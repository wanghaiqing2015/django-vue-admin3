{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\src\\views\\system\\organization.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\src\\views\\system\\organization.vue","mtime":1620834720964},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin3333\\client\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getOrgAll, createOrg, deleteOrg, updateOrg } from '@/api/org'\nimport { genTree } from '@/utils'\nimport checkPermission from '@/utils/permission'\nimport Treeselect from '@riophae/vue-treeselect'\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\n\nconst defaultOrg = {\n  id: null,\n  name: '',\n  parent: null\n}\nexport default {\n  components: { Treeselect },\n  data() {\n    return {\n      org: {\n        id: '',\n        name: '',\n        parent: ''\n      },\n      search: '',\n      tableData: [],\n      orgList: [],\n      listLoading: true,\n      dialogVisible: false,\n      dialogType: 'new',\n      rule1: {\n        name: [{ required: true, message: '请输入名称', trigger: 'blur' }],\n        parent: [{ required: true, message: '请选择上级', trigger: 'change' }]\n      }\n    }\n  },\n  computed: {},\n  created() {\n    this.getList()\n  },\n  methods: {\n    checkPermission,\n    getList() {\n      this.listLoading = true\n      getOrgAll().then(response => {\n        this.orgList = response.data\n        const data = genTree(response.data)\n        this.tableData = data\n        this.listLoading = false\n      })\n    },\n    resetFilter() {\n      this.getList()\n    },\n    handleFilter() {\n      const newData = this.orgList.filter(\n        data =>\n          !this.search ||\n          data.name.toLowerCase().includes(this.search.toLowerCase())\n      )\n      this.tableData = genTree(newData)\n    },\n    handleAdd() {\n      this.org = Object.assign({}, defaultOrg)\n      this.dialogType = 'new'\n      this.dialogVisible = true\n      this.$nextTick(() => {\n        this.$refs['Form'].clearValidate()\n      })\n    },\n    handleEdit(scope) {\n      this.org = Object.assign({}, scope.row) // copy obj\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.$nextTick(() => {\n        this.$refs['Form'].clearValidate()\n      })\n    },\n    handleDelete(scope) {\n      this.$confirm('确认删除?', '警告', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'error'\n      })\n        .then(async() => {\n          await deleteOrg(scope.row.id)\n          this.getList()\n          this.$message({\n            type: 'success',\n            message: '成功删除!'\n          })\n        })\n        .catch(err => {\n          console.error(err)\n        })\n    },\n    async confirmOrg(form) {\n      this.$refs[form].validate(valid => {\n        if (valid) {\n          const isEdit = this.dialogType === 'edit'\n          if (isEdit) {\n            updateOrg(this.org.id, this.org).then(() => {\n              this.getList()\n              this.dialogVisible = false\n              this.$message({\n                message: '编辑成功',\n                type: 'success',\n              })\n            })\n          } else {\n            createOrg(this.org).then(res => {\n              // this.org = res.data\n              // this.tableData.unshift(this.org)\n              this.getList()\n              this.dialogVisible = false\n              this.$message({\n                message: '新增成功',\n                type: 'success',\n              })\n            })\n          }\n        } else {\n          return false\n        }\n      })\n    }\n  }\n}\n",null]}